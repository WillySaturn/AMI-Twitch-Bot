<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>A.M.I. State Test</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #status {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            font-family: Consolas, 'Courier New', monospace;
            font-size: 150px;
            font-weight: bold;
            color: #00ff00;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div id="status">Neutral</div>

    <script>
        const statusDiv = document.getElementById('status');
        let lastState = '';

        function checkState() {
            // Using a more robust XMLHttpRequest instead of fetch
            const xhr = new XMLHttpRequest();
            const url = './ami_state.txt?t=' + new Date().getTime(); // Cache-busting

            xhr.open('GET', url, true);

            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 400) {
                    // Success!
                    const state = xhr.responseText.trim().toLowerCase();
                    if (state !== lastState) {
                        statusDiv.textContent = state || 'neutral';
                        lastState = state;
                    }
                } else {
                    // Reached server, but it returned an error
                    statusDiv.textContent = 'server error';
                }
            };

            xhr.onerror = function() {
                // Could not connect
                statusDiv.textContent = 'connection error';
            };

            xhr.send();
        }

        setInterval(checkState, 250);
    </script>
</body>
</html>